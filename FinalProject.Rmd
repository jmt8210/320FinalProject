---
title: "Final Project"
author: "Brendan Gillespy and Justin Thoms"
date: "5/11/2020"
output: 
  html_document:
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE}
library(tidyverse)
library(kableExtra)
library(cvTools)
library(randomForest)
```

## Project Setup

For this project, we will be making use of the following libraries:
* _tidyverse_ will be used for tidying and manupulating data.frames
* _kableExtra_ will allow us print out useful tables
* _cvTools_ will help us create folds in our data for predictive modeling
* _random forest_ will allow us to use Random Forest modeling on our data


```{r tableFunctions}

#/-----------------------------------------------------------------------------------------------------------------------------------------/#


## Functions in this section deal with selecting only data we need from large dataframes 


rushPassSelect <- function(df){
  df %>%
    select(`Team Code`, Yards)
}

# This function will only select the data we need for our analysis and to create more attributes from the teamGameStats dataframe 
teamGameStatsSelect <- function (df){
  df %>%
    select(`Game Code`, `Team Code`, `Points`, `Rush Yard`, `Pass Yard`, `Kickoff Ret Yard`, `Punt Ret Yard`, `Misc Ret Yard`, `Int Ret Yard`, `Fum Ret Yard`, `Pass Int`, `Fumble Lost`, `Punt`, `Penalty`, `1st Down Rush`, `1st Down Pass`, `1st Down Penalty`, `Time Of Possession`) 
}


#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## Functions in this section deal with adding attributes to the teamGameStats dataframe that require ##

# This function will add the 'yardsAgainst' attribute to the given dataframe
mutateYardsAgainst <- function(df){
  
  findYards <- function(gameCode, teamCode){
    opponentYards <- df %>%
      filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
      select(`Rush Yard`,`Pass Yard`,`Kickoff Ret Yard`,`Punt Ret Yard`,`Misc Ret Yard`,`Int Ret Yard`,`Fum Ret Yard`)
    as.double(opponentYards[1,1]+opponentYards[1,2]+opponentYards[1,3]+opponentYards[1,4]+opponentYards[1,5]+opponentYards[1,6]+opponentYards[1,7])
  }

  colNum <- ncol(df) + 1
  
  for(i in 1:nrow(df)){
    df[i,colNum] = findYards(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
  }

  names(df)[colNum] <- "yardsAgainst"
  
  df
}


# This function will add the 'opponentPoints' attrubute to the given dataframe
mutatePointsAgainst <- function(df){

  findPoints <- function(gameCode, teamCode){
    opponentPoints <- df %>%
      filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
      select(Points)
    as.double(opponentPoints[1,1])
  }
  
  colNum <- ncol(df) + 1
  
  for(i in 1:nrow(df)){
    df[i,colNum] = findPoints(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
  }
  
  names(df)[colNum] <- "opponentPoints"
  
  df
}


#This function will find the 'turnoverDiff' attribute to the given dataframe
mutateTurnoverDiff <- function(df){
  

  findTurnovers <- function(gameCode, teamCode){
    opponentTurnovers <- df %>%
      setNames(make.names(names(.), unique = TRUE)) %>%
      filter(Game.Code == gameCode & Team.Code != teamCode) %>%
      select(Pass.Int, Fumble.Lost, Punt)
    as.double(opponentTurnovers[1,1] + opponentTurnovers[1,2], + opponentTurnovers[1,3])
  }
  
  colNum <- ncol(df) + 1

  for(i in 1:nrow(df)){
    df[i, colNum] = (df[i, "Pass Int"] + df[i, "Fumble Lost"] + df[i, "Punt"]) - findTurnovers(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
    
  }

  names(df)[colNum] <- "turnoverDiff"
  
  df
}


#This function will find the 'timeOfPossessionDifferential' for the given dataframe
mutateTOPDiff <- function(df){
  
  findTOP <- function(gameCode, teamCode){
    opponentTOP <- df %>%
      setNames(make.names(names(.), unique = TRUE)) %>%
      filter(Game.Code == gameCode & Team.Code != teamCode) %>%
      select(Time.Of.Possession)
    as.double(opponentTOP[1,1])
  }

  colNum <- ncol(df) + 1

  for(i in 1:nrow(df)){
    df[i,colNum] = df[i, "Time Of Possession"] - findTOP(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
  }

  names(df)[colNum] <- "timeOfPossesionDifferential"
  
  df
}

#/-----------------------------------------------------------------------------------------------------------------------------------------/#

```

```{r tables, message=FALSE}

#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## These tables hold data about the games - who's home, what the attendance is, etc. ##  

#Importing every year's game data
games2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/game.csv")
games2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/game.csv")
games2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/game.csv")
games2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/game.csv")
games2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/game.csv")
games2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/game.csv")
games2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/game.csv")
games2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/game.csv")
games2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/game.csv")


# rbinding the dataframes into one, long dataframe
games <- rbind(games2005, games2006, games2007, games2008, games2009, games2010, games2011, games2012, games2013)


#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## These dataframes hold data about how each team did in every game. It's most of the data we use in this project. ##

# Importing every year's data frame, making sure to filter out the data we don't need
teamGameStats2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team-game-statistics.csv") %>% teamGameStatsSelect()

# rbinding the the frames together to get one, longer data frame
teamGameStats <- rbind(teamGameStats2013, teamGameStats2012, teamGameStats2011, teamGameStats2010, teamGameStats2009, teamGameStats2008, teamGameStats2007, teamGameStats2006, teamGameStats2005)


# Creating new attributes for teamGameStats using the data we already have
teamGameStats <- teamGameStats %>%
  
  # 'yardsFor' will give us the sum of all yards during a game for the team
  mutate(yardsFor=`Rush Yard`+`Pass Yard`+`Kickoff Ret Yard`+`Punt Ret Yard`+`Misc Ret Yard`+`Int Ret Yard`+`Fum Ret Yard`) %>%
  
  # 'firstDowns' will tell us how many first downs a team got during each game
  mutate(firstDowns=(`1st Down Rush` + `1st Down Pass` + `1st Down Penalty`)) %>%
  
  # 'home' will tell us whether or not the team was home during that game
  inner_join(games2013, by="Game Code") %>%
  mutate(home=(`Team Code` == `Home Team Code` & Site=="TEAM"))
  

teamGameStats <- mutateYardsAgainst(teamGameStats) %>% mutatePointsAgainst() %>% mutateTurnoverDiff() %>% mutateTOPDiff()

teamGameStats <- teamGameStats %>% 
  mutate(win=(opponentPoints<Points))


#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## This dataframes hold per-carry rushing data, including yards per attempt, and which school it was done for ##

rushing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/rush.csv") %>% rushPassSelect()
rushing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/rush.csv") %>% rushPassSelect()
rushing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/rush.csv") %>% rushPassSelect()
rushing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/rush.csv") %>% rushPassSelect()
rushing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/rush.csv") %>% rushPassSelect()
rushing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/rush.csv") %>% rushPassSelect()
rushing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/rush.csv") %>% rushPassSelect()
rushing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/rush.csv") %>% rushPassSelect()
rushing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/rush.csv") %>% rushPassSelect()

rushing <- rbind(rushing2005, rushing2006, rushing2007, rushing2008, rushing2009, rushing2010, rushing2011, rushing2012, rushing2013)


#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## These dataframes hold per-pass passing data, including yards for each attempt, and the school it was done for ##

passing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/pass.csv") %>% rushPassSelect()
passing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/pass.csv") %>% rushPassSelect()
passing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/pass.csv") %>% rushPassSelect()
passing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/pass.csv") %>% rushPassSelect()
passing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/pass.csv") %>% rushPassSelect()
passing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/pass.csv") %>% rushPassSelect()
passing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/pass.csv") %>% rushPassSelect()
passing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/pass.csv") %>% rushPassSelect()
passing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/pass.csv") %>% rushPassSelect()

passing <- rbind(passing2005, passing2006, passing2007, passing2008, passing2009, passing2010, passing2011, passing2012, passing2013)


#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## These dataframes hold some meta-data about each team, including which confrence they're in and what their school name is. ##

teams2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team.csv")
teams2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team.csv")
teams2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team.csv")
teams2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team.csv")
teams2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team.csv")
teams2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team.csv")
teams2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team.csv")
teams2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team.csv")
teams2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team.csv")

teams <- rbind(teams2005, teams2006, teams2007, teams2008, teams2009, teams2010, teams2011, teams2012, teams2013)


#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## These dataframes hold some data about confreneces, including confrence-type, and name. ##

conference2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/conference.csv")
conference2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/conference.csv")
conference2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/conference.csv")
conference2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/conference.csv")
conference2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/conference.csv")
conference2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/conference.csv")
conference2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/conference.csv")
conference2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/conference.csv")
conference2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/conference.csv")

conference <- rbind(conference2013, conference2012, conference2011, conference2010, conference2009, conference2008, conference2007, conference2006, conference2005)
conference <- conference[match(unique(conference$`Conference Code`),conference$`Conference Code`),]

#/-----------------------------------------------------------------------------------------------------------------------------------------/#

## This code creates a new dataframe, containing the sum of total wins by each school ##

seasonWins <- teamGameStats %>%
  filter(win == TRUE) %>%
  group_by(`Team Code`) %>%
  summarize(Wins=n())

```


## Data Management and Organization

As our data was seperated by year, we needed to combine our tables. However, due to the combination of the now massive number of entities and attributes mapped for each entity, particularly within our Team-Game dataset, we needed to only select the attributes that we need for our work. To do this, we

1. Imported all of our indidivudal datasets
2. Selected only the attributes that we needed our calculuations
3. Used rbind() to concatenate all the datasets together
4. Mutated new attributes for entities that combined/relied in on data from other entities
5. Selected the data that we still needed and removed the attributes we needed for our new, mutated ones


## Interesting Visualizations

To get familiar with our dataset, and to make some interesting observations about our data, we decided to do some exploratory data analysis.

{.tabset}
### PPG vs Total Yards

Rationally speaking, if you have more yards, that should correlate to more times that your team has marched down to the end-zone, or at least gotten close. In this graph, we can see that this theory generally holds true, following around a linear regression. This proves that there is correlation between Yards per Game and Points per Game.


```{r yardsToPoints}
# See points scored per game per each number of total yardage
teamGameStats %>%
  ggplot((aes(x=yardsFor, y=Points))) +
  geom_point() +
  geom_smooth(method=lm) +
  labs(x="Total Yards",
       y="Points Scored",
       title = "Points Scored per Yard by Game")
```


## Rushing Yards per Attempt

Next, we wanted to see how effective different progams were on run plays. To do this, we used a grouped together from 5 historically great college football teams... and Maryland, and compared their rushing yards per play with a violin plot. *_*

```{r rushingExploration}
# See the distribution of rushing yards per attempt by several top football schools
rushing %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  inner_join(teams2013, by="Team Code") %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) +
    geom_violin() +
    labs(x="",
         y="Rushing Yards",
         title = "Distribution of Rushing Yards per Attempt by Top Football Schools") +
    theme(legend.position = "none")
```


### Passing Yards per Attempt

Much like the rushing yards per attempt, this graph shows the distribution of passing yards per attempt for the same top schools listed in the rushing attempts.

```{r passingExploration}
# See the distribution of passing yards per attempt by top football schools
passing %>%
  inner_join(teams, by="Team Code") %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) + 
  labs(x="",
       y="Passing Yards",
       title = "Distribution of Passing Yards per Attempt by Top Football Schools") + 
  geom_violin() + 
  theme(legend.position="none")
```

### Wins For Team by Conference

For this graph, we wanted to the distribution of wins for each team per year, to see which teams are historically good, and the dsitributions of teams at certain numbers of wins.

```{r winsExploration}
# See total wins for each team, seperated by conference
seasonWins %>%
  inner_join(teams, by="Team Code") %>%
  inner_join(conference, by="Conference Code") %>%
  filter(Subdivision=="FBS") %>%
  ggplot(aes(x=reorder(factor(Name.x), Wins), y=(Wins/8), color=Name.y)) +
  geom_point() +
  labs(x="Team") +
  theme(axis.text.x=element_blank())
```

# What variable influences wins the most?



## Test variables {.tabset}


### Yards For

```{r yardsFor}
teamGameStats %>%
  ggplot(aes(x=win, y=yardsFor)) + 
  geom_violin()
```


### Yards Against

```{r yardsAgainst}
teamGameStats %>%
  ggplot(aes(x=win, y=yardsAgainst)) + 
  geom_violin()  +
  labs()
```

### Turnovers

```{r turnovers}

teamGameStats %>%
  ggplot(aes(x=win, y=turnoverDiff)) + 
  geom_violin() +
  labs(x="Win",
       y="Turnover Differential",
       title="Turnover Differential Distribution by Game Result")
```



### Home Field Advantage

```{r homeFieldAdvantage}
teamGameStats %>%
  group_by(home, win) %>%
  summarize(count=n()) %>%
  ggplot(aes(x=win, y=count, fill=home)) + 
  geom_bar(stat="identity", position=position_dodge()) + 
  scale_x_discrete(label=c("Lose", "Win")) +
  scale_fill_discrete(labels=c("Away", "Home")) +
  theme(legend.title=element_blank()) +
  labs(x="",
       y="Games",
       title="Home and Away vs Wins and Losses")
```



### First Downs

```{r firstDowns}
teamGameStats %>%
  ggplot(aes(x=win, y=firstDowns)) + 
  geom_violin() +
  labs(x="Win",
       y="Total First Downs",
       title="Total First Down Distribution by Game Result")
```



### Time of Possesion Differential

```{r timeOfPossession}
teamGameStats %>%
  ggplot(aes(x=win, y=timeOfPossesionDifferential)) + 
  geom_violin() +
  labs(x="Win",
       y="Time of Possession Differential",
       title="Time of Possession Differential Distribution by Game Result")
```



### Penalties

```{r penalties}
teamGameStats %>%
  inner_join(teams, by="Team Code") %>%
  inner_join(conference, by="Conference Code") %>%
  ggplot(aes(x=win, y=Penalty)) + geom_violin()
```

## Predictions based on variables {.tabset}

### Yards For

```{r logisticRegressionYardsFor}
testTable <- teamGameStats %>%
  select(yardsFor, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Yards Against

```{r logisticRegressionYardsAgainst}
testTable <- teamGameStats %>%
  select(yardsAgainst, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Turnovers

```{r logisticRegressionTurnovers}
testTable <- teamGameStats %>%
  select(turnoverDiff, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Home Field Advantage

```{r logisitcRegression}
testTable <- teamGameStats %>%
  select(home, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### First Downs

```{r logisticRegressionFirstDowns}
testTable <- teamGameStats %>%
  select(firstDowns, win)

team_data <- testTable %>%
  na.omit()

# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})

avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))

kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Time of Possession

```{r logisticRegressionTOP}
testTable <- teamGameStats %>%
  select(timeOfPossesionDifferential, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Penalties

```{r logisticRegressionPenalties}
testTable <- teamGameStats %>%
  select(Penalty, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### All

```{r logisticRegressionAll}
testTable <- teamGameStats %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, Penalty, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

## Random Forest {.tabset}

### Random Forest - All
```{r randomForestAll, message=FALSE}
testTable <- teamGameStats %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, Penalty, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Yards For
```{r randomForestYardsFor, message=FALSE}
testTable <- teamGameStats %>%
  select(yardsFor, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Yards Against
```{r randomForestYardsAgainst, message=FALSE}
testTable <- teamGameStats %>%
  select(yardsAgainst, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Turnovers
```{r randomForestTurnovers, message=FALSE}
testTable <- teamGameStats %>%
  select(turnoverDiff, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Home Field Advantage
```{r randomForestHome, message=FALSE}
testTable <- teamGameStats %>%
  select(home, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Random Forest - First Downs
```{r randomForestFirstDowns, message=FALSE}
testTable <- teamGameStats %>%
  select(firstDowns, win)

team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Time of Possession
```{r randomForestTimeOfPossession, message=FALSE}
testTable <- teamGameStats %>%
  select(timeOfPossesionDifferential, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Penalty
```{r randomForestPenalty, message=FALSE}
testTable <- teamGameStats %>%
  select(Penalty, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```