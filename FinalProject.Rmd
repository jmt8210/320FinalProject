---
title: "Final Project"
author: "Brendan Gillespy and Justin Thoms"
date: "5/11/2020"
output: html_document
---

#

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE}
library(tidyverse)
library(dplyr)
```


```{r tables, message=FALSE}
attendance2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/game-statistics.csv")
teamGameStats2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team-game-statistics.csv")
rushing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/rush.csv")
passing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/pass.csv")
teams2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team.csv")
games2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/game.csv")
confrence2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/conference.csv")
#Todo: Import all tables, and concat the tables with rbind()
```   

```{r addWinsCol}

findPoints <- function(gameCode, teamCode){
  opponentPoints <- teamGameStats2013 %>%
    filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
    select(Points)
  as.double(opponentPoints[1,1])
}

for(i in 1:nrow(teamGameStats2013)){
  teamGameStats2013[i,69] = findPoints(as.character(teamGameStats2013[i,2]), as.double(teamGameStats2013[i,1]))
}

names(teamGameStats2013)[69] <- "opponentPoints"

teamGameStats2013 <- teamGameStats2013 %>%
  mutate(win=opponentPoints<Points)
teamGameStats2013
```

```{r graph}

teamGameStats2013 %>%
  ggplot((aes(x=(`Pass Yard` + `Rush Yard`), y=Points))) +
  geom_point() +
  geom_smooth(method=lm) +
  labs(x="Total Yards",
       y="Points Scored",
       title = "Points Scored per Yard by Game")


rushing2013 %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  inner_join(teams2013, by="Team Code") %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) +
    geom_violin() +
    labs(x="",
         y="Rushing Yards",
         title = "Distribution of Rushing Yards per Attempt by Top Football Schools") +
    theme(legend.position = "none")


passing2013 %>%
  inner_join(teams2013, by="Team Code") %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) + 
  labs(x="",
       y="Passing Yards",
       title = "Distribution of Passing Yards per Attempt by Top Football Schools") + 
  geom_violin() + 
  theme(legend.position="none")


# Testing Wins ------------------------------------
wins <- teamGameStats2013 %>%
  filter(win == TRUE) %>%
  group_by(`Team Code`) %>%
  summarize(Wins=n())

teamGameStats2013 %>%
  inner_join(wins, by="Team Code")

teamGameStats2013 %>%
  group_by(`Team Code`) %>%
  summarize(rushYards=sum(`Rush Yard`), passYards=sum(`Pass Yard`), wins=sum(win)) %>%
  mutate(equalizer = "All Teams") %>%
  ggplot(aes(x=equalizer, y=wins)) + 
  labs(x="",
       y="Wins",
       title = "Distribution of Passing Yards per Attempt by Top Football Schools") + 
  geom_violin() + 
  theme(legend.position="none")

wins %>%
  inner_join(teams2013, by="Team Code") %>%
  inner_join(confrence2013, by="Conference Code") %>%
  ggplot(aes(x=factor(Name.x), y=Wins, color=ifelse(Subdivision=="FBS", "FBS", "FCS"))) +
  geom_point()

#FCS not included in dataset, only consider FBS

teamGameStats2013 <- wins %>%
  inner_join(teams2013, by="Team Code") %>%
  inner_join(confrence2013, by="Conference Code") %>%
  filter(Subdivision=="FBS")

teamGameStats2013

```


# What variable influences wins the most?

## Test variables:

### Yards For

### Yards Against

### Turnovers

### Home Field Advantage

### First Downs

### Penalties