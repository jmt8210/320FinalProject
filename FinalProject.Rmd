---
title: "Final Project"
author: "Brendan Gillespy and Justin Thoms"
date: "5/11/2020"
output: 
  html_document:
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE}
library(tidyverse)
library(kableExtra)
library(cvTools)
library(randomForest)
```

## Project Setup

For this project, we will be making use of the following libraries:
* _tidyverse_ will be used for tidying and manupulating data.frames
* _kableExtra_ will allow us print out useful tables
* _cvTools_ will help us create folds in our data for predictive modeling
* _random forest_ will allow us to use Random Forest modeling on our data


```{r tables, message=FALSE}

teamGameStats2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team-game-statistics.csv")
teamGameStats2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team-game-statistics.csv")
teamGameStats2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team-game-statistics.csv")
teamGameStats2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team-game-statistics.csv")
teamGameStats2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team-game-statistics.csv")
teamGameStats2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team-game-statistics.csv")
teamGameStats2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team-game-statistics.csv")
teamGameStats2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team-game-statistics.csv")
teamGameStats2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team-game-statistics.csv")

rushing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/rush.csv")
rushing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/rush.csv")
rushing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/rush.csv")
rushing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/rush.csv")
rushing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/rush.csv")
rushing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/rush.csv")
rushing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/rush.csv")
rushing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/rush.csv")
rushing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/rush.csv")

passing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/pass.csv")
passing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/pass.csv")
passing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/pass.csv")
passing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/pass.csv")
passing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/pass.csv")
passing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/pass.csv")
passing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/pass.csv")
passing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/pass.csv")
passing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/pass.csv")

teams2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team.csv")
teams2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team.csv")
teams2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team.csv")
teams2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team.csv")
teams2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team.csv")
teams2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team.csv")
teams2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team.csv")
teams2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team.csv")
teams2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team.csv")

games2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/game.csv")
games2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/game.csv")
games2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/game.csv")
games2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/game.csv")
games2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/game.csv")
games2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/game.csv")
games2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/game.csv")
games2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/game.csv")
games2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/game.csv")

conference2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/conference.csv")
conference2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/conference.csv")
conference2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/conference.csv")
conference2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/conference.csv")
conference2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/conference.csv")
conference2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/conference.csv")
conference2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/conference.csv")
conference2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/conference.csv")
conference2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/conference.csv")

conference <- rbind(conference2013, conference2012, conference2011, conference2010, conference2009, conference2008, conference2007, conference2006, conference2005)
conference <- conference[match(unique(conference$`Conference Code`),conference$`Conference Code`),]

#Todo: Import all tables, and concat the tables with rbind()
```

## Data Management and Organization

As our data was seperated by year, we needed to combine our tables. However, due to the combination of the now massive number of entities and attributes mapped for each entity, particularly within our Team-Game dataset, we needed to only select the attributes that we need for our work. To do this, we

1. Imported all of our indidivudal datasets
2. Selected only the attributes that we needed our calculuations
3. Used rbind() to concatenate all the datasets together
4. Mutated new attributes for entities that combined/relied in on data from other entities
5. Selected the data that we still needed and removed the attributes we needed for our new, mutated ones

```{r organizeData}
findPoints <- function(gameCode, teamCode){
  opponentPoints <- teamGameStats2013 %>%
    filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
    select(Points)
  as.double(opponentPoints[1,1])
}

nextCol = ncol(teamGameStats)

for(i in 1:nrow(teamGameStats2013)){
  teamGameStats2013[i,69] = findPoints(as.character(teamGameStats2013[i,2]), as.double(teamGameStats2013[i,1]))
}
names(teamGameStats2013)[69] <- "opponentPoints"
teamGameStats2013 <- teamGameStats2013 %>%
  mutate(win=opponentPoints<Points)
seasonWins2013 <- teamGameStats2013 %>%
  filter(win == TRUE) %>%
  group_by(`Team Code`) %>%
  summarize(Wins=n())
```


## Interesting Visualizations

To get familiar with our dataset, and to make some interesting observations about our data, we decided to do some exploratory data analysis.

{.tabset}
### PPG vs Total Yards

Rationally speaking, if you have more yards, that should correlate to more times that your team has marched down to the end-zone, or at least gotten close. In this graph, we can see that this theory generally holds true, following around a linear regression. This proves that there is correlation between Yards per Game and Points per Game.

```{r yardsToPoints}
# See points scored per game per each number of total yardage
teamGameStats2013 %>%
  ggplot((aes(x=(`Rush Yard`+`Pass Yard`+`Kickoff Ret Yard`+`Punt Ret Yard`+`Misc Ret Yard`+`Int Ret Yard`+`Fum Ret Yard`), y=Points))) +
  geom_point() +
  geom_smooth(method=lm) +
  labs(x="Total Yards",
       y="Points Scored",
       title = "Points Scored per Yard by Game")
```


## Rushing Yards per Attempt

Next, we wanted to see how effective different progams were on run plays. To do this, we used a grouped together from 5 historically great college football teams... and Maryland, and compared their rushing yards per play with a violin plot. *_*

```{r rushingExploration}
# See the distribution of rushing yards per attempt by several top football schools
rushing2013 %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  inner_join(teams2013, by="Team Code") %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) +
    geom_violin() +
    labs(x="",
         y="Rushing Yards",
         title = "Distribution of Rushing Yards per Attempt by Top Football Schools") +
    theme(legend.position = "none")
```


### Passing Yards per Attempt

Much like the rushing yards per attempt, this graph shows the distribution of passing yards per attempt for the same top schools listed in the rushing attempts.

```{r passingExploration}
# See the distribution of passing yards per attempt by top football schools
passing2013 %>%
  inner_join(teams2013, by="Team Code") %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) + 
  labs(x="",
       y="Passing Yards",
       title = "Distribution of Passing Yards per Attempt by Top Football Schools") + 
  geom_violin() + 
  theme(legend.position="none")
```

### Wins For Team by Conference

For this graph, we wanted to the distribution of wins for each team per year, to see which teams are historically good, and the dsitributions of teams at certain numbers of wins.

```{r winsExploration}
# See total wins for each team, seperated by conference
seasonWins2013 %>%
  inner_join(teams2013, by="Team Code") %>%
  inner_join(conference2013, by="Conference Code") %>%
  filter(Subdivision=="FBS") %>%
  ggplot(aes(x=reorder(factor(Name.x), Wins), y=(Wins/8), color=Name.y)) +
  geom_point() +
  labs(x="Team") +
  theme(axis.text.x=element_blank())
# I added a reorder to the above plot, I'm not sure if it helps or not, I just couldn't come to any conclusions from the graph before.
```

# What variable influences wins the most?



## Test variables {.tabset}


### Yards For

```{r yardsFor}
teamGameStats2013 <- teamGameStats2013 %>%
  mutate(yardsFor=`Rush Yard`+`Pass Yard`+`Kickoff Ret Yard`+`Punt Ret Yard`+`Misc Ret Yard`+`Int Ret Yard`+`Fum Ret Yard`)

teamGameStats2013 %>%
  ggplot(aes(x=win, y=yardsFor)) + 
  geom_violin()
```


### Yards Against

```{r yardsAgainst}
findYards <- function(gameCode, teamCode){
  opponentYards <- teamGameStats2013 %>%
    filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
    select(`Rush Yard`,`Pass Yard`,`Kickoff Ret Yard`,`Punt Ret Yard`,`Misc Ret Yard`,`Int Ret Yard`,`Fum Ret Yard`)
  as.double(opponentYards[1,1]+opponentYards[1,2]+opponentYards[1,3]+opponentYards[1,4]+opponentYards[1,5]+opponentYards[1,6]+opponentYards[1,7])
}

colNum <- ncol(teamGameStats2013) + 1

for(i in 1:nrow(teamGameStats2013)){
  teamGameStats2013[i,colNum] = findYards(as.character(teamGameStats2013[i,2]), as.double(teamGameStats2013[i,1]))
}

names(teamGameStats2013)[colNum] <- "yardsAgainst"
teamGameStats2013 %>%
  ggplot(aes(x=win, y=yardsAgainst)) + 
  geom_violin()  +
  labs()
```

### Turnovers

```{r turnovers}
findTurnovers <- function(gameCode, teamCode){
  opponentTurnovers <- teamGameStats2013 %>%
    setNames(make.names(names(.), unique = TRUE)) %>%
    filter(Game.Code == gameCode & Team.Code != teamCode) %>%
    select(Pass.Int, Fumble.Lost, Punt)
  as.double(opponentTurnovers[1,1] + opponentTurnovers[1,2], + opponentTurnovers[1,3])
}

colNum <- ncol(teamGameStats2013) + 1

for(i in 1:nrow(teamGameStats2013)){
  teamGameStats2013[i, colNum] = (teamGameStats2013[i, 45] + teamGameStats2013[i, 10] + teamGameStats2013[i, 37]) - findTurnovers(as.character(teamGameStats2013[i,2]), as.double(teamGameStats2013[i,1]))
}

names(teamGameStats2013)[colNum] <- "turnoverDiff"
teamGameStats2013 %>%
  ggplot(aes(x=win, y=turnoverDiff)) + 
  geom_violin() +
  labs(x="Win",
       y="Turnover Differential",
       title="Turnover Differential Distribution by Game Result")
```



### Home Field Advantage

```{r homeFieldAdvantage}
teamGameStats2013 <- teamGameStats2013 %>%
  inner_join(games2013, by="Game Code") %>%
  mutate(home=(`Team Code` == `Home Team Code` & Site=="TEAM"))
teamGameStats2013 %>%
  group_by(home, win) %>%
  summarize(count=n()) %>%
  ggplot(aes(x=win, y=count, fill=home)) + 
  geom_bar(stat="identity", position=position_dodge()) + 
  scale_x_discrete(label=c("Lose", "Win")) +
  scale_fill_discrete(labels=c("Away", "Home")) +
  theme(legend.title=element_blank()) +
  labs(x="",
       y="Games",
       title="Home and Away vs Wins and Losses")
```



### First Downs

```{r firstDowns}
teamGameStats2013 <- teamGameStats2013 %>%
  mutate(firstDowns=(`1st Down Rush` + `1st Down Pass` + `1st Down Penalty`))

teamGameStats2013 %>%
  ggplot(aes(x=win, y=firstDowns)) + 
  geom_violin() +
  labs(x="Win",
       y="Total First Downs",
       title="Total First Down Distribution by Game Result")
```



### Time of Possesion Differential

```{r timeOfPossession}
findTOP <- function(gameCode, teamCode){
  opponentTOP <- teamGameStats2013 %>%
    setNames(make.names(names(.), unique = TRUE)) %>%
    filter(Game.Code == gameCode & Team.Code != teamCode) %>%
    select(Time.Of.Possession)
  as.double(opponentTOP[1,1])
}

colNum <- ncol(teamGameStats2013) + 1

for(i in 1:nrow(teamGameStats2013)){
  teamGameStats2013[i,colNum] = teamGameStats2013[i, 59] - findTOP(as.character(teamGameStats2013[i,2]), as.double(teamGameStats2013[i,1]))
}

names(teamGameStats2013)[colNum] <- "timeOfPossesionDifferential"
teamGameStats2013 %>%
  ggplot(aes(x=win, y=timeOfPossesionDifferential)) + 
  geom_violin() +
  labs(x="Win",
       y="Time of Possession Differential",
       title="Time of Possession Differential Distribution by Game Result")
```



### Penalties

```{r penalties}
teamGameStats2013 %>%
  inner_join(teams2013, by="Team Code") %>%
  inner_join(conference2013, by="Conference Code") %>%
  ggplot(aes(x=win, y=Penalty)) + geom_violin()
```

## Predictions based on variables {.tabset}

### Yards For

```{r logisticRegressionYardsFor}
testTable <- teamGameStats2013 %>%
  select(yardsFor, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Yards Against

```{r logisticRegressionYardsAgainst}
testTable <- teamGameStats2013 %>%
  select(yardsAgainst, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Turnovers

```{r logisticRegressionTurnovers}
testTable <- teamGameStats2013 %>%
  select(turnoverDiff, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Home Field Advantage

```{r logisitcRegression}
testTable <- teamGameStats2013 %>%
  select(home, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### First Downs

```{r logisticRegressionFirstDowns}
testTable <- teamGameStats2013 %>%
  select(firstDowns, win)

team_data <- testTable %>%
  na.omit()

# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})

avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))

kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Time of Possession

```{r logisticRegressionTOP}
testTable <- teamGameStats2013 %>%
  select(timeOfPossesionDifferential, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Penalties

```{r logisticRegressionPenalties}
testTable <- teamGameStats2013 %>%
  select(Penalty, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### All

```{r logisticRegressionAll}
testTable <- teamGameStats2013 %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, Penalty, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

## Random Forest {.tabset}

### Random Forest - All
```{r randomForestAll}
testTable <- teamGameStats2013 %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, Penalty, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Yards For
```{r randomForestYardsFor}
testTable <- teamGameStats2013 %>%
  select(yardsFor, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Yards Against
```{r randomForestYardsAgainst}
testTable <- teamGameStats2013 %>%
  select(yardsAgainst, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Turnovers
```{r randomForestTurnovers}
testTable <- teamGameStats2013 %>%
  select(turnoverDiff, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Home Field Advantage
```{r randomForestHome}
testTable <- teamGameStats2013 %>%
  select(home, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Random Forest - First Downs
```{r randomForestFirstDowns}
testTable <- teamGameStats2013 %>%
  select(firstDowns, win)

team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Time of Possession
```{r randomForestTimeOfPossession}
testTable <- teamGameStats2013 %>%
  select(timeOfPossesionDifferential, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Penalty
```{r randomForestPenalty}
testTable <- teamGameStats2013 %>%
  select(Penalty, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```