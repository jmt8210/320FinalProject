---
title: "Final Project"
author: "Brendan Gillespy and Justin Thoms"
date: "5/11/2020"
output: 
  html_document:
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## Project Setup

```{r libraries, message=FALSE}
library(tidyverse)
library(kableExtra)
library(cvTools)
library(randomForest)
```

For this project, we will be making use of the following libraries:

- _tidyverse_ will be used for tidying and manupulating data.frames
- _kableExtra_ will allow us print out useful tables
- _cvTools_ will help us create folds in our data for predictive modeling
- _random forest_ will allow us to use Random Forest modeling on our data

## Data Management and Organization

As our data was seperated by year, we needed to combine our tables. However, due to the combination of the now massive number of entities and attributes mapped for each entity, particularly within our Team-Game dataset, we needed to only select the attributes that we need for our work. To do this, we

```{r tableFunctions}

#/---------------------------------------------------------------------------------------------------------------/#


## Functions in this section deal with selecting only data we need from large dataframes 


rushPassSelect <- function(df){
  df %>%
    select(`Team Code`, Yards)
}

# This function will only select the data we need for our analysis and to create more attributes from the teamGameStats dataframe 
teamGameStatsSelect <- function (df){
  df %>%
    select(`Game Code`, `Team Code`, `Points`, `Rush Yard`, `Pass Yard`, `Kickoff Ret Yard`, `Punt Ret Yard`, `Misc Ret Yard`, `Int Ret Yard`, `Fum Ret Yard`, `Pass Int`, `Fumble Lost`, `Punt`, `Penalty`, `1st Down Rush`, `1st Down Pass`, `1st Down Penalty`, `Time Of Possession`) 
}


#/---------------------------------------------------------------------------------------------------------------/#

## Functions in this section deal with adding attributes to the teamGameStats dataframe that require ##

# This function will add the 'yardsAgainst' attribute to the given dataframe
mutateYardsAgainst <- function(df){
  
  findYards <- function(gameCode, teamCode){
    opponentYards <- df %>%
      filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
      select(`Rush Yard`,`Pass Yard`,`Kickoff Ret Yard`,`Punt Ret Yard`,`Misc Ret Yard`,`Int Ret Yard`,`Fum Ret Yard`)
    as.double(opponentYards[1,1]+opponentYards[1,2]+opponentYards[1,3]+opponentYards[1,4]+opponentYards[1,5]+opponentYards[1,6]+opponentYards[1,7])
  }

  colNum <- ncol(df) + 1
  
  for(i in 1:nrow(df)){
    df[i,colNum] = findYards(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
  }

  names(df)[colNum] <- "yardsAgainst"
  
  df
}


# This function will add the 'opponentPoints' attrubute to the given dataframe
mutatePointsAgainst <- function(df){

  findPoints <- function(gameCode, teamCode){
    opponentPoints <- df %>%
      filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
      select(Points)
    as.double(opponentPoints[1,1])
  }
  
  colNum <- ncol(df) + 1
  
  for(i in 1:nrow(df)){
    df[i,colNum] = findPoints(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
  }
  
  names(df)[colNum] <- "opponentPoints"
  
  df
}


#This function will find the 'turnoverDiff' attribute to the given dataframe
mutateTurnoverDiff <- function(df){
  

  findTurnovers <- function(gameCode, teamCode){
    opponentTurnovers <- df %>%
      setNames(make.names(names(.), unique = TRUE)) %>%
      filter(Game.Code == gameCode & Team.Code != teamCode) %>%
      select(Pass.Int, Fumble.Lost, Punt)
    as.double(opponentTurnovers[1,1] + opponentTurnovers[1,2], + opponentTurnovers[1,3])
  }
  
  colNum <- ncol(df) + 1

  for(i in 1:nrow(df)){
    df[i, colNum] = (df[i, "Pass Int"] + df[i, "Fumble Lost"] + df[i, "Punt"]) - findTurnovers(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
    
  }

  names(df)[colNum] <- "turnoverDiff"
  
  df
}


#This function will find the 'timeOfPossessionDifferential' for the given dataframe
mutateTOPDiff <- function(df){
  
  findTOP <- function(gameCode, teamCode){
    opponentTOP <- df %>%
      setNames(make.names(names(.), unique = TRUE)) %>%
      filter(Game.Code == gameCode & Team.Code != teamCode) %>%
      select(Time.Of.Possession)
    as.double(opponentTOP[1,1])
  }

  colNum <- ncol(df) + 1

  for(i in 1:nrow(df)){
    df[i,colNum] = df[i, "Time Of Possession"] - findTOP(as.character(df[i,"Game Code"]), as.double(df[i,"Team Code"]))
  }

  names(df)[colNum] <- "timeOfPossesionDifferential"
  
  df
}

#/---------------------------------------------------------------------------------------------------------------/#

```
```{r tables, message=FALSE}

#/---------------------------------------------------------------------------------------------------------------/#

## These tables hold data about the games - who's home, what the attendance is, etc. ##  

#Importing every year's game data
games2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/game.csv")
games2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/game.csv")
games2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/game.csv")
games2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/game.csv")
games2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/game.csv")
games2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/game.csv")
games2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/game.csv")
games2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/game.csv")
games2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/game.csv")


# rbinding the dataframes into one, long dataframe
games <- games2013#rbind(games2005, games2006, games2007, games2008, games2009, games2010, games2011, games2012, games2013)


#/---------------------------------------------------------------------------------------------------------------/#

## These dataframes hold data about how each team did in every game. It's most of the data we use in this project. ##

# Importing every year's data frame, making sure to filter out the data we don't need
teamGameStats2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team-game-statistics.csv") %>% teamGameStatsSelect()

# rbinding the the frames together to get one, longer data frame
#teamGameStats <- rbind(teamGameStats2013, teamGameStats2012, teamGameStats2011, teamGameStats2010, teamGameStats2009, teamGameStats2008, teamGameStats2007, teamGameStats2006, teamGameStats2005)


# Creating new attributes for teamGameStats using the data we already have
teamGameStats <- teamGameStats2013 %>%
  
  # 'yardsFor' will give us the sum of all yards during a game for the team
  mutate(yardsFor=`Rush Yard`+`Pass Yard`+`Kickoff Ret Yard`+`Punt Ret Yard`+`Misc Ret Yard`+`Int Ret Yard`+`Fum Ret Yard`) %>%
  
  # 'firstDowns' will tell us how many first downs a team got during each game
  mutate(firstDowns=(`1st Down Rush` + `1st Down Pass` + `1st Down Penalty`)) %>%
  
  # 'home' will tell us whether or not the team was home during that game
  inner_join(games, by="Game Code") %>%
  mutate(home=(`Team Code` == `Home Team Code` & Site=="TEAM"))
  

teamGameStats <- mutateYardsAgainst(teamGameStats) %>% mutatePointsAgainst() %>% mutateTurnoverDiff() %>% mutateTOPDiff()

teamGameStats <- teamGameStats %>% 
  mutate(win=(opponentPoints<Points))


#/---------------------------------------------------------------------------------------------------------------/#

## This dataframes hold per-carry rushing data, including yards per attempt, and which school it was done for ##

rushing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/rush.csv") %>% rushPassSelect()
rushing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/rush.csv") %>% rushPassSelect()
rushing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/rush.csv") %>% rushPassSelect()
rushing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/rush.csv") %>% rushPassSelect()
rushing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/rush.csv") %>% rushPassSelect()
rushing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/rush.csv") %>% rushPassSelect()
rushing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/rush.csv") %>% rushPassSelect()
rushing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/rush.csv") %>% rushPassSelect()
rushing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/rush.csv") %>% rushPassSelect()

rushing <- rushing2013#rbind(rushing2005, rushing2006, rushing2007, rushing2008, rushing2009, rushing2010, rushing2011, rushing2012, rushing2013)


#/---------------------------------------------------------------------------------------------------------------/#

## These dataframes hold per-pass passing data, including yards for each attempt, and the school it was done for ##

passing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/pass.csv") %>% rushPassSelect()
passing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/pass.csv") %>% rushPassSelect()
passing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/pass.csv") %>% rushPassSelect()
passing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/pass.csv") %>% rushPassSelect()
passing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/pass.csv") %>% rushPassSelect()
passing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/pass.csv") %>% rushPassSelect()
passing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/pass.csv") %>% rushPassSelect()
passing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/pass.csv") %>% rushPassSelect()
passing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/pass.csv") %>% rushPassSelect()

passing <- passing2013#rbind(passing2005, passing2006, passing2007, passing2008, passing2009, passing2010, passing2011, passing2012, passing2013)


#/---------------------------------------------------------------------------------------------------------------/#

## These dataframes hold some meta-data about each team, including which confrence they're in and what their school name is. ##

teams2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team.csv")
teams2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team.csv")
teams2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team.csv")
teams2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team.csv")
teams2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team.csv")
teams2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team.csv")
teams2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team.csv")
teams2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team.csv")
teams2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team.csv")

teams <- teams2013#rbind(teams2005, teams2006, teams2007, teams2008, teams2009, teams2010, teams2011, teams2012, teams2013)


#/---------------------------------------------------------------------------------------------------------------/#

## These dataframes hold some data about confreneces, including confrence-type, and name. ##

conference2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/conference.csv")
conference2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/conference.csv")
conference2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/conference.csv")
conference2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/conference.csv")
conference2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/conference.csv")
conference2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/conference.csv")
conference2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/conference.csv")
conference2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/conference.csv")
conference2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/conference.csv")

conference <- congerence2013#rbind(conference2013, conference2012, conference2011, conference2010, conference2009, conference2008, conference2007, conference2006, conference2005)
#conference <- conference[match(unique(conference$`Conference Code`),conference$`Conference Code`),]

#/---------------------------------------------------------------------------------------------------------------/#

## This code creates a new dataframe, containing the sum of total wins by each school ##

seasonWins <- teamGameStats %>%
  filter(win == TRUE) %>%
  group_by(`Team Code`) %>%
  summarize(Wins=n())

```

1. Create some functions that we'll use for data organization
2. Imported all of our indidivudal datasets
2. Selected only the attributes that we needed our calculuations
3. Used rbind() to concatenate all the datasets together
4. Mutated new attributes for entities that combined/relied in on data from other entities
5. Selected the data that we still needed and removed the attributes we needed for our new, mutated ones


## Interesting Visualizations

To get familiar with our dataset, and to make some interesting observations about our data, we decided to do some exploratory data analysis.

{.tabset}
### PPG vs Total Yards

Rationally speaking, if you have more yards, that should correlate to more times that your team has marched down to the end-zone, or at least gotten close. In this graph, we can see that this theory generally holds true, following around a linear regression. This proves that there is correlation between Yards per Game and Points per Game.


```{r yardsToPoints}
# See points scored per game per each number of total yardage
teamGameStats %>%
  ggplot((aes(x=yardsFor, y=Points))) +
  geom_point() +
  geom_smooth(method=lm) +
  labs(x="Total Yards",
       y="Points Scored",
       title = "Points Scored per Yard by Game")
```


## Rushing Yards per Attempt

Next, we wanted to see how effective different progams were on run plays. To do this, we used a grouped together from 5 historically great college football teams... and Maryland, and compared their rushing yards per play with a violin plot. *_*

```{r rushingExploration}
# See the distribution of rushing yards per attempt by several top football schools
rushing %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  inner_join(teams2013, by="Team Code") %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) +
    geom_violin() +
    labs(x="",
         y="Rushing Yards",
         title = "Distribution of Rushing Yards per Attempt by Top Football Schools") +
    theme(legend.position = "none")
```


### Passing Yards per Attempt

Much like the rushing yards per attempt, this graph shows the distribution of passing yards per attempt for the same top schools listed in the rushing attempts.

```{r passingExploration}
# See the distribution of passing yards per attempt by top football schools
passing %>%
  inner_join(teams, by="Team Code") %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) + 
  labs(x="",
       y="Passing Yards",
       title = "Distribution of Passing Yards per Attempt by Top Football Schools") + 
  geom_violin() + 
  theme(legend.position="none")
```

### Wins For Team by Conference

For this graph, we wanted to the distribution of wins for each team per year, to see which teams are historically good, and the dsitributions of teams at certain numbers of wins.

```{r winsExploration}
# See total wins for each team, seperated by conference
seasonWins %>%
  inner_join(teams, by="Team Code") %>%
  inner_join(conference, by="Conference Code") %>%
  filter(Subdivision=="FBS") %>%
  ggplot(aes(x=reorder(factor(Name.x), Wins), y=(Wins/8), color=Name.y)) +
  geom_point() +
  labs(x="Team") +
  theme(axis.text.x=element_blank())
```

# What variable influences wins the most?



## Test variables {.tabset}

In order to determine the viability of each variable as a predictor for wins, we will first visualize the relationship of each variable vs. wins and later use regression to see if it can be used to correctly identify games as wins or losses.

### Yards For

```{r yardsFor}
teamGameStats %>%
  ggplot(aes(x=win, y=yardsFor)) + 
  geom_violin() +
  labs(x="Win",
       y="Yards For",
       title="Yards For Team Distribution by Game Result")
```

As expected, yards plays a big role in a team's ability to win the game. Reaching the red zone or endzone more than your opponent in order to score more points means the winning team will most likely have more yards by the end of the game. This variable would be a good predictor in the winner of a game.

### Yards Against

```{r yardsAgainst}
teamGameStats %>%
  ggplot(aes(x=win, y=yardsAgainst)) + 
  geom_violin() +
  labs(x="Win",
       y="Yards Against",
       title="Yards Against Team Distribution by Game Result")
```

Similarly to Yards For, yards against shows that a team needs to have its opponent end up with less yards by the end of the game, meaning that they will have less chances to score. This is also a valid predictor for wins.


### Turnovers

```{r turnovers}

teamGameStats %>%
  ggplot(aes(x=win, y=turnoverDiff)) + 
  geom_violin() +
  labs(x="Win",
       y="Turnover Differential",
       title="Turnover Differential Distribution by Game Result")
```
In this case, turnovers include any time a team gives up possession of the ball, including fumbles, interceptions, punts, and turnover on downs.

Turnovers have a good potential to be a predictor of wins. Teams that turn over the ball less compared to their opponent have more chances to score. However, there seems to be more spread in the distribution of turnover differential for games won, so it is possible that it will be harder to predict with.



### Home Field Advantage

```{r homeFieldAdvantage}
teamGameStats %>%
  group_by(home, win) %>%
  summarize(count=n()) %>%
  ggplot(aes(x=win, y=count, fill=home)) + 
  geom_bar(stat="identity", position=position_dodge()) + 
  scale_x_discrete(label=c("Loss", "Win")) +
  scale_fill_discrete(labels=c("Away", "Home")) +
  theme(legend.title=element_blank()) +
  labs(x="",
       y="Games",
       title="Home and Away vs Wins and Losses")
```

This variable was one of the most interesting to analyze. According to popular belief, "Home Field Advantage" is when the home team supposedly has a higher chance to win the game. This could be due to more home team fans cheering them on, or not having to travel far for the game. Whatever differences this causes in the player's attitude towards the game is reflected in this plot. Teams that are home seem to win more often than not, and teams that are away seem to lose much more than they win.


### First Downs

```{r firstDowns}
teamGameStats %>%
  ggplot(aes(x=win, y=firstDowns)) + 
  geom_violin() +
  labs(x="Win",
       y="Total First Downs",
       title="Total First Down Distribution by Game Result")
```
Amount of first downs in a game is another expected side effect of a winning team. The more first downs a team gets, the more chances they have at getting more yards and the more chances they have to score. It is clear that teams who get more first downs in a game are more likely to win, which could be a good predictor for our model.


### Time of Possesion Differential

```{r timeOfPossession}
teamGameStats %>%
  ggplot(aes(x=win, y=timeOfPossesionDifferential)) + 
  geom_violin() +
  labs(x="Win",
       y="Time of Possession Differential",
       title="Time of Possession Differential Distribution by Game Result")
```
Time of possession includes all of the time a team is on offense. In theory, this could be a predictor based on the fact that the team who has control of the game has the most control over who has possession. The graph mostly follows this assumption, with winning teams having a higher average time of possession.


### Penalties

```{r penalties}
teamGameStats %>%
  inner_join(teams, by="Team Code") %>%
  inner_join(conference, by="Conference Code") %>%
  ggplot(aes(x=win, y=Penalty)) + geom_violin()
```
This plot shows that the distribution of penalties between the winning and losing teams tends to be very similar. Since there is no difference between number of penalties and winning or losing, this cannot be a valid predictor of whether or not a team will win.


## Random Forest Prediction Error For Each Variable {.tabset}

For each of the previous variables, we will run a regression model using a random forest to determine whether the variable could be a valid predictor of a team winning a game based on the stats in that category at the end of the game. These predictions can then be used to conclude which is most important in determining the outcome of a game, which will later be used to determine the accuracy of our prediction model. 

### Yards For

```{r logisticRegressionYardsFor, warning=FALSE}
regressionData <- teamGameStats %>%
  select(yardsFor, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame(Error=mean(error))
```

### Yards Against

```{r logisticRegressionYardsAgainst, warning=FALSE}
regressionData <- teamGameStats %>%
  select(yardsAgainst, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame(Error=mean(error))
```

### Turnovers

```{r logisticRegressionTurnovers, warning=FALSE}
regressionData <- teamGameStats %>%
  select(turnoverDiff, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame(Error=mean(error))
```

### Home Field Advantage

```{r logisitcRegression, warning=FALSE}
regressionData <- teamGameStats %>%
  select(home, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame(Error=mean(error))
```

### First Downs

```{r logisticRegressionFirstDowns, warning=FALSE}
regressionData <- teamGameStats %>%
  select(firstDowns, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame(Error=mean(error))
```


### Time of Possession

```{r logisticRegressionTOP, warning=FALSE}
regressionData <- teamGameStats %>%
  select(timeOfPossesionDifferential, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame(Error=mean(error))
```


### Penalties

```{r logisticRegressionPenalties, warning=FALSE}
regressionData <- teamGameStats %>%
  select(Penalty, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame(Error=mean(error))
```

# Choosing a Prediction Model

Each of the prediction types, random forest and logistic regression, will be tested on all of the valid variables. The smallest error from each of the predictions will determine which prediction model is better for determining the outcome of a game, and how well we can predict a game based on the given variables. 

## Random Forest

```{r randomForestAll, warning=FALSE}

regressionData <- teamGameStats %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <-  randomForest(win~., data=regressionData[-fold,])
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame("Random Forest Error"=mean(error))
```


## Logistic

```{r}
regressionData <- teamGameStats %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, win)
folds <- cvFolds(n=nrow(regressionData), K = 10)
error <- vector()
for(i in 1:10) {
  fold <- which(folds$which == i)
  model <- glm(win~., data = regressionData[-fold,], family = "binomial")
  prediction <- ifelse(predict(model, regressionData[fold,]) > 0.5, 1, 0)
  error <- c(error, mean(regressionData[fold,]$win != prediction))
}
data.frame("Logistic Error"=mean(error))
```

Analyzing the error from each of the predictions, the logistic regression seems to be the better model.

The value of the error shows that the model can predict the winner of games about 90% of the time. This is a significant value that shows that the most important factors in winning a football game are the total yards for each team, the difference in turnovers between teams, whether a team is home or away, and the length of time that a team spends on offense.

