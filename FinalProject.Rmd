---
title: "Final Project"
author: "Brendan Gillespy and Justin Thoms"
date: "5/11/2020"
output: 
  html_document:
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE}
library(tidyverse)
library(caret)
library(kableExtra)
library(cvTools)
```


```{r tables, message=FALSE}

games2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/game.csv")
games2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/game.csv")
games2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/game.csv")
games2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/game.csv")
games2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/game.csv")
games2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/game.csv")
games2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/game.csv")
games2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/game.csv")
games2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/game.csv")

games <- rbind(games2005, games2006, games2007, games2008, games2009, games2010, games2011, games2012, games2013)

teamGameStatsSelect <- function (df){
  df %>%
    select(`Game Code`, `Team Code`, `Points`, `Rush Yard`, `Pass Yard`, `Kickoff Ret Yard`, `Punt Ret Yard`, `Misc Ret Yard`, `Int Ret Yard`, `Fum Ret Yard`, `Pass Int`, `Fumble Lost`, `Punt`, `Penalty`, `1st Down Rush`, `1st Down Pass`, `1st Down Penalty`, `Time Of Possession`) 
}


teamGameStats2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team-game-statistics.csv") %>% teamGameStatsSelect()
teamGameStats <- rbind(teamGameStats2005, teamGameStats2006, teamGameStats2007, teamGameStats2008, teamGameStats2009, teamGameStats2010, teamGameStats2011, teamGameStats2012, teamGameStats2013) %>%
  mutate(yardsFor=`Rush Yard`+`Pass Yard`+`Kickoff Ret Yard`+`Punt Ret Yard`+`Misc Ret Yard`+`Int Ret Yard`+`Fum Ret Yard`) %>%
  inner_join(games2013, by="Game Code") %>%
  mutate(home=(`Team Code` == `Home Team Code` & Site=="TEAM")) %>%
  mutate(firstDowns=(`1st Down Rush` + `1st Down Pass` + `1st Down Penalty`))

findYards <- function(gameCode, teamCode){
  opponentYards <- teamGameStats %>%
    filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
    select(`Rush Yard`,`Pass Yard`,`Kickoff Ret Yard`,`Punt Ret Yard`,`Misc Ret Yard`,`Int Ret Yard`,`Fum Ret Yard`)
  as.double(opponentYards[1,1]+opponentYards[1,2]+opponentYards[1,3]+opponentYards[1,4]+opponentYards[1,5]+opponentYards[1,6]+opponentYards[1,7])
}

colNum <- ncol(teamGameStats) + 1

for(i in 1:nrow(teamGameStats)){
  teamGameStats[i,colNum] = findYards(as.character(teamGameStats[i,"Game Code"]), as.double(teamGameStats[i,"Team Code"]))
}

names(teamGameStats)[colNum] <- "yardsAgainst"


colNum <- ncol(teamGameStats) + 1

findPoints <- function(gameCode, teamCode){
  opponentPoints <- teamGameStats %>%
    filter(`Game Code` == gameCode & `Team Code` != teamCode) %>%
    select(Points)
  as.double(opponentPoints[1,1])
}
for(i in 1:nrow(teamGameStats)){
  teamGameStats[i,colNum] = findPoints(as.character(teamGameStats[i,"Game Code"]), as.double(teamGameStats[i,"Team Code"]))
}
names(teamGameStats)[colNum] <- "opponentPoints"


findTurnovers <- function(gameCode, teamCode){
  opponentTurnovers <- teamGameStats %>%
    setNames(make.names(names(.), unique = TRUE)) %>%
    filter(Game.Code == gameCode & Team.Code != teamCode) %>%
    select(Pass.Int, Fumble.Lost, Punt)
  as.double(opponentTurnovers[1,1] + opponentTurnovers[1,2], + opponentTurnovers[1,3])
}

colNum <- ncol(teamGameStats) + 1

for(i in 1:nrow(teamGameStats)){
  teamGameStats[i, colNum] = (teamGameStats[i, "Pass Int"] + teamGameStats[i, "Fumble Lost"] + teamGameStats[i, "Punt"]) - findTurnovers(as.character(teamGameStats[i,"Game Code"]), as.double(teamGameStats[i,"Team Code"]))
}

names(teamGameStats)[colNum] <- "turnoverDiff"

findTOP <- function(gameCode, teamCode){
  opponentTOP <- teamGameStats %>%
    setNames(make.names(names(.), unique = TRUE)) %>%
    filter(Game.Code == gameCode & Team.Code != teamCode) %>%
    select(Time.Of.Possession)
  as.double(opponentTOP[1,1])
}

colNum <- ncol(teamGameStats) + 1

for(i in 1:nrow(teamGameStats)){
  teamGameStats[i,colNum] = teamGameStats[i, "Time Of Possession"] - findTOP(as.character(teamGameStats[i,"Game Code"]), as.double(teamGameStats[i,"Team Code"]))
}

names(teamGameStats)[colNum] <- "timeOfPossesionDifferential"

teamGameStats <- teamGameStats %>% 
  mutate(win=(opponentPoints<Points))



rushPassSelect <- function(df){
  df %>%
    select(`Team Code`, Yards)
}

rushing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/rush.csv") %>% rushPassSelect()
rushing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/rush.csv") %>% rushPassSelect()
rushing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/rush.csv") %>% rushPassSelect()
rushing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/rush.csv") %>% rushPassSelect()
rushing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/rush.csv") %>% rushPassSelect()
rushing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/rush.csv") %>% rushPassSelect()
rushing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/rush.csv") %>% rushPassSelect()
rushing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/rush.csv") %>% rushPassSelect()
rushing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/rush.csv") %>% rushPassSelect()

rushing <- rbind(rushing2005, rushing2006, rushing2007, rushing2008, rushing2009, rushing2010, rushing2011, rushing2012, rushing2013)


passing2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/pass.csv") 
passing2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/pass.csv")
passing2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/pass.csv")
passing2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/pass.csv")
passing2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/pass.csv")
passing2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/pass.csv")
passing2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/pass.csv")
passing2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/pass.csv")
passing2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/pass.csv")

passing <- rbind(passing2005, passing2006, passing2007, passing2008, passing2009, passing2010, passing2011, passing2012, passing2013)

teams2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/team.csv")
teams2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/team.csv")
teams2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/team.csv")
teams2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/team.csv")
teams2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/team.csv")
teams2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/team.csv")
teams2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/team.csv")
teams2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/team.csv")
teams2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/team.csv")

teams <- rbind(teams2005, teams2006, teams2007, teams2008, teams2009, teams2010, teams2011, teams2012, teams2013)


conference2005 <- read_csv("college-football-statistics/cfbstats-com-2005-1-5-0/conference.csv") %>% select()
conference2006 <- read_csv("college-football-statistics/cfbstats-com-2006-1-5-0/conference.csv")
conference2007 <- read_csv("college-football-statistics/cfbstats-com-2007-1-5-0/conference.csv")
conference2008 <- read_csv("college-football-statistics/cfbstats-com-2008-1-5-0/conference.csv")
conference2009 <- read_csv("college-football-statistics/cfbstats-com-2009-1-5-0/conference.csv")
conference2010 <- read_csv("college-football-statistics/cfbstats-com-2010-1-5-0/conference.csv")
conference2011 <- read_csv("college-football-statistics/cfbstats-com-2011-1-5-0/conference.csv")
conference2012 <- read_csv("college-football-statistics/cfbstats-com-2012-1-5-4/conference.csv")
conference2013 <- read_csv("college-football-statistics/cfbstats-com-2013-1-5-20/conference.csv")

conference <- rbind(conference2005, conference2006, conference2007, conference2008, conference2009, conference2010, conference2011, conference2012, conference2013)
conference <- conference[match(unique(conference$`Conference Code`),conference$`Conference Code`),]

#Todo: Import all tables, and concat the tables with rbind()
```

```{r organizeData}
seasonWins <- teamGameStats %>%
  filter(win == TRUE) %>%
  group_by(`Team Code`) %>%
  summarize(Wins=n())
```


## Interesting Visualizations {.tabset}

### PPG vs Total Yards

```{r graph}
# See points scored per game per each number of total yardage
teamGameStats %>%
  ggplot((aes(x=yardsFor, y=Points))) +
  geom_point() +
  geom_smooth(method=lm) +
  labs(x="Total Yards",
       y="Points Scored",
       title = "Points Scored per Yard by Game")
```


### Rushing Yards per Attempt
```{r rushingExploration}
# See the distribution of rushing yards per attempt by several top football schools
rushing %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  inner_join(teams2013, by="Team Code") %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) +
    geom_violin() +
    labs(x="",
         y="Rushing Yards",
         title = "Distribution of Rushing Yards per Attempt by Top Football Schools") +
    theme(legend.position = "none")
```


### Passing Yards per Attempt
```{r passingExploration}
# See the distribution of passing yards per attempt by top football schools
passing %>%
  inner_join(teams, by="Team Code") %>%
  filter(`Team Code` == 392 | `Team Code` == 8 | `Team Code` == 518 | `Team Code` == 147 | `Team Code` == 365 | `Team Code` == 522) %>%
  ggplot(aes(x=reorder(factor(Name), Yards), y=Yards, color=Name)) + 
  labs(x="",
       y="Passing Yards",
       title = "Distribution of Passing Yards per Attempt by Top Football Schools") + 
  geom_violin() + 
  theme(legend.position="none")
```

### Wins For Team by Conference
```{r winsExploration}
# See total wins for each team, seperated by conference
seasonWins %>%
  inner_join(teams, by="Team Code") %>%
  inner_join(conference, by="Conference Code") %>%
  filter(Subdivision=="FBS") %>%
  ggplot(aes(x=reorder(factor(Name.x), Wins), y=Wins, color=Name.y)) +
  geom_point() +
  labs(x="Team") +
  theme(axis.text.x=element_blank())
```

# What variable influences wins the most?

## Test variables {.tabset}


### Yards For

```{r yardsFor}
teamGameStats %>%
  ggplot(aes(x=win, y=yardsFor)) + 
  geom_violin()
```


### Yards Against

```{r yardsAgainst}
teamGameStats %>%
  ggplot(aes(x=win, y=yardsAgainst)) + 
  geom_violin()  +
  labs()
```

### Turnovers

```{r turnovers}

teamGameStats %>%
  ggplot(aes(x=win, y=turnoverDiff)) + 
  geom_violin() +
  labs(x="Win",
       y="Turnover Differential",
       title="Turnover Differential Distribution by Game Result")
```



### Home Field Advantage

```{r homeFieldAdvantage}
teamGameStats %>%
  group_by(home, win) %>%
  summarize(count=n()) %>%
  ggplot(aes(x=win, y=count, fill=home)) + 
  geom_bar(stat="identity", position=position_dodge()) + 
  scale_x_discrete(label=c("Lose", "Win")) +
  scale_fill_discrete(labels=c("Away", "Home")) +
  theme(legend.title=element_blank()) +
  labs(x="",
       y="Games",
       title="Home and Away vs Wins and Losses")
```



### First Downs

```{r firstDowns}
teamGameStats %>%
  ggplot(aes(x=win, y=firstDowns)) + 
  geom_violin() +
  labs(x="Win",
       y="Total First Downs",
       title="Total First Down Distribution by Game Result")
```



### Time of Possesion Differential

```{r timeOfPossession}
teamGameStats %>%
  ggplot(aes(x=win, y=timeOfPossesionDifferential)) + 
  geom_violin() +
  labs(x="Win",
       y="Time of Possession Differential",
       title="Time of Possession Differential Distribution by Game Result")
```



### Penalties

```{r penalties}
teamGameStats %>%
  inner_join(teams, by="Team Code") %>%
  inner_join(conference, by="Conference Code") %>%
  ggplot(aes(x=win, y=Penalty)) + geom_violin()
```

## Predictions based on variables {.tabset}

### Yards For

```{r logisticRegressionYardsFor}
testTable <- teamGameStats %>%
  select(yardsFor, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Yards Against

```{r logisticRegressionYardsAgainst}
testTable <- teamGameStats %>%
  select(yardsAgainst, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Turnovers

```{r logisticRegressionTurnovers}
testTable <- teamGameStats %>%
  select(turnoverDiff, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Home Field Advantage

```{r logisitcRegression}
testTable <- teamGameStats %>%
  select(home, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### First Downs

```{r logisticRegressionFirstDowns}
testTable <- teamGameStats %>%
  select(firstDowns, win)

team_data <- testTable %>%
  na.omit()

# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})

avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))

kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Time of Possession

```{r logisticRegressionTOP}
testTable <- teamGameStats %>%
  select(timeOfPossesionDifferential, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Penalties

```{r logisticRegressionPenalties}
testTable <- teamGameStats %>%
  select(Penalty, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### All

```{r logisticRegressionAll}
testTable <- teamGameStats %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, Penalty, win)
team_data <- testTable %>%
  na.omit()
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  glm(win~., data = train_set, family = "binomial")
  logis_pred <- ifelse(predict(logis_fit, newdata = test_set, type = "response") > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

## Random Forest {.tabset}

### Random Forest - All
```{r randomForestAll}
testTable <- teamGameStats %>%
  select(yardsFor, yardsAgainst, turnoverDiff, home, timeOfPossesionDifferential, Penalty, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Yards For
```{r randomForestYardsFor}
testTable <- teamGameStats %>%
  select(yardsFor, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Yards Against
```{r randomForestYardsAgainst}
testTable <- teamGameStats %>%
  select(yardsAgainst, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Turnovers
```{r randomForestTurnovers}
testTable <- teamGameStats %>%
  select(turnoverDiff, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Home Field Advantage
```{r randomForestHome}
testTable <- teamGameStats %>%
  select(home, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


### Random Forest - First Downs
```{r randomForestFirstDowns}
testTable <- teamGameStats %>%
  select(firstDowns, win)

team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Time of Possession
```{r randomForestTimeOfPossession}
testTable <- teamGameStats %>%
  select(timeOfPossesionDifferential, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

### Random Forest - Penalty
```{r randomForestPenalty}
testTable <- teamGameStats %>%
  select(Penalty, win)
team_data <- testTable
# Divide data set into 10 folds
fold_indices <- cvFolds(n=nrow(testTable), K = 10)
error_rates <- sapply(1:10, function(fold_index) {
  test_indices <- which(fold_indices$which == fold_index)
  # Get test and training set
  test_set <- testTable[test_indices,]
  train_set <- testTable[-test_indices,]
  
  # Fit the logistic regression model  
  logis_fit <-  randomForest::randomForest(win~., data=train_set)
  logis_pred <- ifelse(predict(logis_fit, test_set) > 0.5, 1, 0)
  logis_error <- mean(test_set$win != logis_pred)
  
  logis_error
})
avg_error_rates <- as.data.frame(t(error_rates)) %>%
  mutate(fold=1:n()) %>%
  gather(method,error,-fold) %>%
  # Get the average error rate
  summarize(error = mean(error))
kable(avg_error_rates) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```